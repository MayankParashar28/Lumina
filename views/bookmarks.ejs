<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('./partials/header') %>
        <title>My Bookmarks | Lumina</title>
        <style>
            .bookmarks-container {
                max-width: 900px;
                margin: 8rem auto 4rem;
                padding: 0 1.5rem;
            }

            .page-title {
                font-weight: 800;
                margin-bottom: 2rem;
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }

            .empty-state {
                text-align: center;
                padding: 4rem 1rem;
                color: #6c757d;
            }

            .bookmark-grid {
                display: grid;
                gap: 1.5rem;
            }

            .bookmark-card {
                background: #fff;
                border-radius: 12px;
                padding: 1.5rem;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
                transition: transform 0.2s;
                display: flex;
                gap: 1.5rem;
                align-items: center;
                text-decoration: none;
                color: inherit;
                border: 1px solid rgba(0, 0, 0, 0.05);
            }

            .bookmark-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            }

            .bookmark-img {
                width: 120px;
                height: 80px;
                object-fit: cover;
                border-radius: 8px;
                flex-shrink: 0;
            }

            .bookmark-content {
                flex: 1;
            }

            .bookmark-title {
                font-size: 1.25rem;
                font-weight: 700;
                margin-bottom: 0.5rem;
                color: #212529;
            }

            .bookmark-meta {
                font-size: 0.85rem;
                color: #6c757d;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .remove-btn {
                background: none;
                border: none;
                color: #dc3545;
                cursor: pointer;
                padding: 0.5rem;
                font-size: 1.1rem;
                opacity: 0.7;
                transition: opacity 0.2s;
            }

            .remove-btn:hover {
                opacity: 1;
            }

            @media (max-width: 768px) {
                .bookmark-card {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 1rem;
                }

                .bookmark-img {
                    width: 100%;
                    height: 160px;
                }
            }
        </style>
</head>

<body>
    <%- include('./partials/nav', { searchQuery: '' }) %>

        <div class="bookmarks-container">
            <h1 class="page-title"><i class="fas fa-bookmark text-primary"></i> Reading List</h1>

            <% if (bookmarks.length===0) { %>
                <div class="empty-state">
                    <i class="far fa-bookmark fa-3x mb-3" style="opacity: 0.3;"></i>
                    <h3>No bookmarks yet</h3>
                    <p>Save stories you love to read them later.</p>
                    <a href="/" class="btn btn-primary mt-3">Explore Stories</a>
                </div>
                <% } else { %>
                    <div class="bookmark-grid">
                        <% bookmarks.forEach(blog=> { %>
                            <div class="position-relative">
                                <a href="/blog/<%= blog._id %>" class="bookmark-card">
                                    <% if(blog.coverImageURL) { %>
                                        <img src="<%= blog.coverImageURL %>" alt="" class="bookmark-img">
                                        <% } %>
                                            <div class="bookmark-content">
                                                <h3 class="bookmark-title">
                                                    <%= blog.title %>
                                                </h3>
                                                <div class="bookmark-meta">
                                                    <% if(blog.createdBy) { %>
                                                        <span>
                                                            <%= blog.createdBy.fullName %>
                                                        </span>
                                                        <span>Â·</span>
                                                        <% } %>
                                                            <span>
                                                                <%= new Date(blog.createdAt).toLocaleDateString() %>
                                                            </span>
                                                </div>
                                            </div>
                                </a>
                                <!-- Remove Action (Outside anchor to prevent navigation) -->
                                <button class="remove-btn position-absolute top-0 end-0 m-2"
                                    onclick="removeBookmark('<%= blog._id %>', this)" title="Remove">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <% }) %>
                    </div>
                    <% } %>
        </div>

        <%- include('./partials/footer') %>

            <script>
                async function removeBookmark(blogId, btn) {
                    if (!confirm('Remove this story from your reading list?')) return;

                    try {
                        const res = await fetch(`/user/bookmark/${blogId}`, { method: 'POST' });
                        const data = await res.json();
                        if (data.success) {
                            // Remove the card visually
                            const card = btn.closest('.position-relative');
                            card.style.opacity = '0';
                            setTimeout(() => card.remove(), 300);

                            // If empty, reload to show empty state (lazy way)
                            setTimeout(() => {
                                if (document.querySelectorAll('.bookmark-card').length === 0) {
                                    location.reload();
                                }
                            }, 400);
                        }
                    } catch (err) {
                        console.error("Failed to remove bookmark", err);
                        alert("Error removing bookmark.");
                    }
                }
            </script>
</body>

</html>